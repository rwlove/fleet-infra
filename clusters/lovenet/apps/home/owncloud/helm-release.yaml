---
apiVersion: helm.toolkit.fluxcd.io/v2beta1
kind: HelmRelease
metadata:
  name: owncloud
  namespace: home
spec:
  interval: 5m
  chart:
    spec:
      # renovate: registryUrl=https://charts.bitnami.com/bitnami
      chart: owncloud
      version: 10.2.8
      sourceRef:
        kind: HelmRepository
        name: bitnami-charts
        namespace: flux-system
      interval: 5m
  values:
    image:
      registry: docker.io
      repository: bitnami/owncloud
      tag: 10.6.0-debian-10-r71
      pullPolicy: IfNotPresent
      debug: true

    ## ownCloud host to create application URLs
    ## ref: https://github.com/bitnami/bitnami-docker-owncloud#configuration
    ##
    #owncloudHost:

    ## User of the application
    ## ref: https://github.com/bitnami/bitnami-docker-owncloud#configuration
    ##
    owncloudUsername: user

    ## Application password
    ## Defaults to a random 10-character alphanumeric string if not set
    ## ref: https://github.com/bitnami/bitnami-docker-owncloud#configuration
    ##
    owncloudPassword: password

    ## Admin email
    ## ref: https://github.com/bitnami/bitnami-docker-owncloud#configuration
    ##
    owncloudEmail: terp4life2001@gmail.com

    ## Set to `yes` to allow the container to be started with blank passwords
    ## ref: https://github.com/bitnami/bitnami-docker-owncloud#environment-variables
    ##
    allowEmptyPassword: "yes"

    updateStrategy:
      type: RollingUpdate

    ## MariaDB chart configuration
    ##
    ## https://github.com/bitnami/charts/blob/master/bitnami/mariadb/values.yaml
    ##
    mariadb:
      enabled: true
      architecture: standalone
      auth:
        ## ref: https://github.com/bitnami/bitnami-docker-mariadb#setting-the-root-password-on-first-run
        rootPassword: "password"
        ## MariaDB custom user and database
        ## ref: https://github.com/bitnami/bitnami-docker-mariadb/blob/master/README.md#creating-a-database-on-first-run
        ## ref: https://github.com/bitnami/bitnami-docker-mariadb/blob/master/README.md#creating-a-database-user-on-first-run
        ##
        database: bitnami_owncloud
        username: bn_owncloud
        password: "password"

      master:
        persistence:
          enabled: true
          storageClass: owncloud-mariadb-storage-class
          accessMode: ReadWriteOnce
          size: 8Gi

    service:
      type: LoadBalancer
      loadBalancerIP: 192.168.6.49
      ports:
        - port: 8080
        - port: 8443

    persistence:
      enabled: true
      storageClass: "owncloud-config-storage-class"
      accessMode: ReadWriteOnce
      size: 8Gi

    ## Configure resource requests and limits
    ## ref: http://kubernetes.io/docs/user-guide/compute-resources/
    ##
    resources:
      requests:
        memory: 512Mi
        cpu: 300m

    ## Prometheus Exporter / Metrics
    ##
    metrics:
      enabled: true
      image:
        registry: docker.io
        repository: bitnami/apache-exporter
        tag: 0.8.0-debian-10-r315
        pullPolicy: IfNotPresent

      ## Prometheus exporter service parameters
      ##
      service:
        type: ClusterIP
        ## Metrics port
        ##
        port: 9117
        ## Annotations for the Prometheus exporter service
        ##
        annotations:
          prometheus.io/scrape: "true"
          prometheus.io/port: "{{ .Values.metrics.service.port }}"
